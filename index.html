<!DOCTYPE html>
<html>
    <head>
        <title>
            Safe Zones
	</title>
 	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	<meta charset="utf-8" />
     <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"/>
     <link rel="stylesheet" type="text/css" href="bootstrap.min.css">
     <link rel="stylesheet" type="text/css" href="index.css">
    </head>
    <body>
        <div id="map"></div>
	    <div class="container">
		    <div class="modal" id="request" tabindex="-1" role="dialog">
			<div class="modal-dialog" role="document">
			<div class="modal-content" >
			    <div class="modal-header" >
				<form align-content="center">
				    <div class="form-group" >
				    <h1 class="text-center">Safe Zone Request Form</h1>
				    </div>
				</form>
			    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
				<span aria-hidden="true">&times;</span>
			    </button>
			    </div>
			    <div class="modal-footer">
				<iframe src='https://webchat.botframework.com/embed/epsosafe-know-bot?s=rngPCtBXvc0.7XLzTm5P5i62_6Lxr91H3tMuCFvydJwwLa-B8wTmvB8'  style='min-width: 400px; width: 100%; min-height: 500px;'></iframe>
			    </div>
			</div>
			</div>
		    </div><!-- modal ends -->
	    </div><!-- end container -->

<div id="spinner">
  <h1>SEARCHING ZONES</h1>
  <svg id="Loader" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59.9 59.9"><style>.st0{fill:none;stroke:url(#Spinner_Three_1_);stroke-width:10;stroke-linecap:round;stroke-miterlimit:10;} .st1{fill:none;stroke:url(#Spinner_Two_1_);stroke-width:10;stroke-linecap:round;stroke-miterlimit:10;} .st2{fill:none;stroke:url(#Spinner_One_1_);stroke-width:10;stroke-linecap:round;stroke-miterlimit:10;}</style><linearGradient id="Spinner_Three_1_" gradientUnits="userSpaceOnUse" x1="6.438" y1="22.643" x2="33.438" y2="22.643" gradientTransform="rotate(120 29.938 29.937)"><stop offset="0" stop-color="#7CFFFB"/><stop offset=".428" stop-color="#54B0B7" stop-opacity=".781"/><stop offset=".46" stop-color="#4B9EA8" stop-opacity=".738"/><stop offset=".536" stop-color="#397988" stop-opacity=".634"/><stop offset=".615" stop-color="#2A5A6E" stop-opacity=".525"/><stop offset=".698" stop-color="#1E425A" stop-opacity=".412"/><stop offset=".786" stop-color="#16314B" stop-opacity=".292"/><stop offset=".881" stop-color="#112743" stop-opacity=".162"/><stop offset="1" stop-color="#0F2440" stop-opacity="0"/></linearGradient><path id="Spinner_Three" class="st0" d="M34.9 10.6c1.7.4 3.4 1.1 5.1 2.1 9.6 5.5 12.8 17.8 7.3 27.3"/><linearGradient id="Spinner_Two_1_" gradientUnits="userSpaceOnUse" x1="6.438" y1="22.643" x2="33.438" y2="22.643" gradientTransform="rotate(-120 29.937 29.938)"><stop offset="0" stop-color="#7CFFFB"/><stop offset=".428" stop-color="#54B0B7" stop-opacity=".781"/><stop offset=".46" stop-color="#4B9EA8" stop-opacity=".738"/><stop offset=".536" stop-color="#397988" stop-opacity=".634"/><stop offset=".615" stop-color="#2A5A6E" stop-opacity=".525"/><stop offset=".698" stop-color="#1E425A" stop-opacity=".412"/><stop offset=".786" stop-color="#16314B" stop-opacity=".292"/><stop offset=".881" stop-color="#112743" stop-opacity=".162"/><stop offset="1" stop-color="#0F2440" stop-opacity="0"/></linearGradient><path id="Spinner_Two" class="st1" d="M44.3 43.9c-1.2 1.3-2.7 2.4-4.3 3.3-9.6 5.5-21.8 2.2-27.3-7.3"/><linearGradient id="Spinner_One_1_" gradientUnits="userSpaceOnUse" x1="6.438" y1="22.643" x2="33.438" y2="22.643"><stop offset="0" stop-color="#7CFFFB"/><stop offset=".428" stop-color="#54B0B7" stop-opacity=".781"/><stop offset=".46" stop-color="#4B9EA8" stop-opacity=".738"/><stop offset=".536" stop-color="#397988" stop-opacity=".634"/><stop offset=".615" stop-color="#2A5A6E" stop-opacity=".525"/><stop offset=".698" stop-color="#1E425A" stop-opacity=".412"/><stop offset=".786" stop-color="#16314B" stop-opacity=".292"/><stop offset=".881" stop-color="#112743" stop-opacity=".162"/><stop offset="1" stop-color="#0F2440" stop-opacity="0"/></linearGradient><path id="Spinner_One" class="st2" d="M10.7 35.3c-.5-1.7-.7-3.5-.7-5.4 0-11 9-20 20-20"/></svg>
</div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>    
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

	<script type='text/javascript' src='http://www.bing.com/api/maps/mapcontrol?callback=GetMap&key=[YOUR_BING_MAPS_KEY]' async defer></script>
	<script src="https://cdn.botframework.com/botframework-webchat/latest/webchat.js"></script>
	<script>
		let map;
		function GetMap(){
			map = new Microsoft.Maps.Map('#map', {
				center: new Microsoft.Maps.Location(31.7593968,-106.4894896),
				zoom: 15,
				showDashboard: false
				});
			// community foundation coordinates: 31.7593968,-106.4894896
	    	}
		function insertPins(map){
			var center = map.getCenter();
			var pin = new Microsoft.Maps.Pushpin(new Microsoft.Maps.Location(31.7593968,-106.4894896), {
			    title: 'Community',
			    subTitle: 'Foundation',
			    text: '1'
			});		//do the map stuff here
			var infobox = new Microsoft.Maps.Infobox(center, { title: 'Community Foundation', description: '<a href="#">Navigate</a>', visible: false });
			infobox.setMap(map);
			Microsoft.Maps.Events.addHandler(pin, 'click', function () {
			    infobox.setOptions({ visible: true });
			});
			setTimeout(function(){
				//add the pin
				map.entities.push(pin);
			}, 3000);
		}
		$('document').ready(()=>{
        		$('#request').modal('show');
			GetMap();
			 window.WebChat.renderWebChat(
			    {
			       directLine: window.WebChat.createDirectLine({
				  token: 'YOUR_DIRECT_LINE_TOKEN'
			       }),
			       userID: 'YOUR_USER_ID',
			       username: 'Web Chat User',
			       locale: 'en-US',
			       botAvatarInitials: 'WC',
			       userAvatarInitials: 'WW'
			    },
			    document.getElementById('webchat')
			 );
		});

		$('#request').on('hide.bs.modal', function(e){
			insertPins(map);
			console.log('this is getting called');
			$('#spinner').css('display', 'flex');
		});
	</script>
    </body>
</html>
